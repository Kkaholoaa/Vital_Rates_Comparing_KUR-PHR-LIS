---
title: "IPM_analyses"
author: "Caroline Rodriguez"
date: "6/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(cache = FALSE)
```

```{r}
## Loading libraries
library(ggplot2)
library(plyr)
library(dplyr)
library(tidyr)
library(reshape2)
library(stringr)
```

Run This!
```{r BasicIPMsFunctions,}
options(stringsAsFactors=FALSE)

# Global mesh variables 

#Run the first 2 chunks of analysis.Rmd ("Loading dataframes" and "Modify input")
#then calculate the min and max observed sizes

# 
# ggplot(ColonyLevel, aes(x=log10_ES))+
#   geom_histogram()+
#   facet_wrap("TransitionTypeSimple")+
#   theme_bw()

#min.size <- 0.9*min(c(ColonyLevel$log10_SS, ColonyLevel$log10_ES), na.rm = T)
max.size <- 1.1*max(c(log10(ColonyLevel$StartingSize), log10(ColonyLevel$EndingSize)), na.rm = T)

n = 50 #mesh size / number of cells in the discretized kernel
rec.size <- -0.1  # 2*sqrt((10^-0.1)/pi)  # approx 5 cm  diameter coral
#max.size <- 2     # 2*sqrt((10^2)/pi)     # approx 11 m diameter coral (ridiculous, but avoids boundary issues)
min.size <- -0.5   # 2*sqrt((10^-2.5)/pi)  # approx 6 cm  diameter coral
bin_size <- min.size + c(0:n) * (max.size - min.size)/n #boundary points (the edges of the cells defining the kernel 
y <- 0.5 * (bin_size[1:n]+bin_size[2:(n+1)]) #mesh points (midpoints of cells)
I <- y >= rec.size
delta_size <- y[2] - y[1] #width of cells (h)
  
inv.logit <- function(x) {
  exp(x)/(1+exp(x))
}

################################################################################
###### The growth model ########################################################
################################################################################

growth_function <- function(y, x, g.int, g.slp, g.var) {
  mu <- (g.int + g.slp * x)
  sig <- sqrt(g.var)
  dnorm(y, mean=mu, sd=sig)
}

################################################################################
###### The survival model ######################################################
################################################################################

 survival_function <- function(x, s.int, s.slp) {
   #, s.int, s.slp)
   Line <- s.slp * x + s.int
   u <- inv.logit(Line) # From binomial glm, link = logit function
   # removed bakground mortality due to temp. 
   # Could add something in to add more stochasiticity?
   return(u)
 }


################################################################################
###### The reproduction model ##################################################
################################################################################

reproduction_function <- function(y, x, rec, rec.size=rec.size,ind = TRUE) {
  # 2*sqrt((10^-2.5)/pi)  # approx 6 cm  diameter coral
  if (ind == TRUE){
    out <- rep(0,length(x)) #changed
    out[1:4] <- rec/4} #changed
  
    #out[x < rec.size | y >= rec.size] <- 0}

  if (ind == FALSE){
    out <-  (10^x) * rec
    out[x < rec.size | y >= rec.size] <- 0 #if x is below recruitment size then it doesn't count 
   }
  return(out)
}


################################################################################
########## ... Running the IPM ... #############################################
################################################################################
bigmatrix <- function(ModelParameters) {
  rec <- ModelParameters$rec
  g.int <- ModelParameters$g.int
  g.slp <- ModelParameters$g.slp
  g.var <- ModelParameters$g.var
  s.int <- ModelParameters$s.int
  s.slp <- ModelParameters$s.slp
  
  Reproduction_kernel <- delta_size * outer(y, y, 
                                          reproduction_function, rec = rec)

  Growth_kernel <- delta_size * outer(y, y, growth_function, g.int=g.int, 
                                    g.slp=g.slp, g.var=g.var)
  ## Growth Kernel
  # only works inside the function or if you have done this by had
  #image(y,y,t(Growth_kernel))
  
  Survival_kernel <- survival_function(y, s.int=s.int, s.slp=s.slp)
  
  P <- Growth_kernel
  i <- 1:n

  P[,i] <- Growth_kernel[,i]*Survival_kernel[i]
  
  K <- P + Reproduction_kernel
  
  lam <- Re(eigen(K)$values[1])
  w <- Re(eigen(K)$vectors[,1])
  stabledist <- w/sum(w) # right eigenvector/stable distribution
  v.eigen <- Re(eigen(t(K))$vectors[,1]) #left eigenvector
  reprodvalue <- v.eigen/v.eigen[1] #reproductive value
  
  # lam <- Re(eigen(K)$values[1])
  # w <- Re(eigen(K)$vectors[,1])
  # stabledist <- w/sum(w) # right eigenvector/stable distribution
  # v.eigen <- Re(eigen(t(K))$vectors[,1]) #left eigenvector
  # reprodvalue <- v.eigen/v.eigen[1] #reproductive value

  #compute sensitivity and elasticity matrices using the eigenvectors and eigenvalue
  v.dot.w <- sum(stabledist * reprodvalue) * delta_size
  sens <- outer(reprodvalue,stabledist) / v.dot.w
  elas <- matrix(as.vector(sens) * as.vector(K) / lam, nrow = n)
  
  return(list(K=K, lam=lam, w=stabledist, v=reprodvalue,
              v.dot.w=v.dot.w, sens=sens, elas=elas))
}

#load("./data/SiteInterval_allmodfits_noNAs.rdata")
load("./data/SiteInterval_no2015_allmodfits_noNAs.rdata")
POCS <- data[data$Genus_Code == "POCS",]
POSP <- data[data$Genus_Code == "POSP",]
MOSP <- data[data$Genus_Code == "MOSP",]
```

```{r CalculatingRecVals,}
# Run this and change the recruitment values until you get a value for each Genera that returns a lambda of 1.000__ (we don't care about the values in the digits after the three zeros)

recvalpc <- 34.169  #excl 2015 #28.55 incl all intervals  
recvalpp <- 26.259  #excl 2015#24.85 incl all intervals  
recvalmp <- 30.13  #excl 2015 #25.25 incl all intervals

i <- 1
MP_POCS <- list(rec = recvalpc, 
                  g.int = POCS$g.int[i], 
                  g.slp = POCS$g.slp[i], 
                  g.var = POCS$g.var[i], 
                  s.int = POCS$s.int[i], 
                  s.slp = POCS$s.slp[i])
  
pocs        <- bigmatrix(MP_POCS)
print(pocs$lam)
  
MP_POSP <- list(rec = recvalpp, 
                  g.int = POSP$g.int[i], 
                  g.slp = POSP$g.slp[i], 
                  g.var = POSP$g.var[i], 
                  s.int = POSP$s.int[i], 
                  s.slp = POSP$s.slp[i])
posp        <- bigmatrix(MP_POSP)  
print(posp$lam)

MP_MOSP <- list(rec = recvalmp, 
                  g.int = MOSP$g.int[i], 
                  g.slp = MOSP$g.slp[i], 
                  g.var = MOSP$g.var[i], 
                  s.int = MOSP$s.int[i], 
                  s.slp = MOSP$s.slp[i])
  
mosp        <- bigmatrix(MP_MOSP)
print(mosp$lam)

# Continue onto the next chunk to calculate the change in lambdas at the different site/intervals
```


```{r CalculatingLamsSensElas,}
# Run this chunk to calculate the lambdas and the elas/sens


POCS_lam <- c()
POSP_lam <- c()
MOSP_lam <- c()

# Change this to save the files as a new name, so they do not overwrite anything
Name <- "No_2015"
for (i in 1:nrow(POCS)){ 
  MP_POCS <- list(rec = recvalpc, 
                  g.int = POCS$g.int[i], 
                  g.slp = POCS$g.slp[i], 
                  g.var = POCS$g.var[i], 
                  s.int = POCS$s.int[i], 
                  s.slp = POCS$s.slp[i])
  
  pocs        <- bigmatrix(MP_POCS)
  POCS_lam[i] <- pocs$lam
  K <- pocs$K
  Sens<- pocs$sens
  Elas <- pocs$elas
  sdf <- pocs$v.dot.w
  write.csv(K, sprintf("data/Kernels/%s_Kernel_POCS_%s_%s.csv", 
                       Name,POCS$Sites[i], POCS$Years[i]))
  write.csv(Sens, sprintf("data/Sens/%s_Sens_POCS_%s_%s.csv", 
                          Name,POCS$Sites[i], POCS$Years[i]))
  write.csv(Elas, sprintf("data/Elas/%s_Elas_POCS_%s_%s.csv", 
                          Name,POCS$Sites[i], POCS$Years[i]))
}
L_POCS <- data.frame(Sites = POCS$Sites, Years = POCS$Years, 
                     Genus_Code = POCS$Genus_Code, Lambdas = POCS_lam)


for (i in 1:nrow(POSP)){
  MP_POSP <- list(rec = recvalpp, 
                  g.int = POSP$g.int[i], 
                  g.slp = POSP$g.slp[i], 
                  g.var = POSP$g.var[i], 
                  s.int = POSP$s.int[i], 
                  s.slp = POSP$s.slp[i])
  posp        <- bigmatrix(MP_POSP)
  POSP_lam[i] <- posp$lam
  K    <- posp$K
  Sens <- posp$sens
  Elas <- posp$elas
  write.csv(K, sprintf("data/Kernels/%s_Kernel_POSP_%s_%s.csv", 
                       Name,POSP$Sites[i], POSP$Years[i]))
  write.csv(Sens, sprintf("data/Sens/%s_Sens_POSP_%s_%s.csv", 
                          Name,POSP$Sites[i], POSP$Years[i]))
  write.csv(Elas, sprintf("data/Elas/%s_Elas_POSP_%s_%s.csv", 
                          Name,POSP$Sites[i], POSP$Years[i]))      
}
L_POSP <- data.frame(Sites = POSP$Sites, Years = POSP$Years, 
                     Genus_Code = POSP$Genus_Code, Lambdas = POSP_lam)

for (i in 1:nrow(MOSP)){
  MP_MOSP <- list(rec = recvalmp, 
                  g.int = MOSP$g.int[i], 
                  g.slp = MOSP$g.slp[i], 
                  g.var = MOSP$g.var[i], 
                  s.int = MOSP$s.int[i], 
                  s.slp = MOSP$s.slp[i])
  
  mosp        <- bigmatrix(MP_MOSP)
  MOSP_lam[i] <- mosp$lam
  K    <- mosp$K
  Sens <- mosp$sens
  Elas <- mosp$elas
  write.csv(K, sprintf("data/Kernels/%s_Kernel_ MOSP_%s_%s.csv", 
                        Name,MOSP$Sites[i],  MOSP$Years[i]))
  write.csv(Sens, sprintf("data/Sens/%s_Sens_ MOSP_%s_%s.csv", 
                           Name,MOSP$Sites[i],  MOSP$Years[i]))
  write.csv(Elas, sprintf("data/Elas/%s_Elas_MOSP_%s_%s.csv", 
                           Name,MOSP$Sites[i],  MOSP$Years[i]))
}
L_MOSP <- data.frame(Sites = MOSP$Sites, Years = MOSP$Years, 
                     Genus_Code = MOSP$Genus_Code, Lambdas = MOSP_lam)

Lambdas <- rbind(L_POCS, L_POSP, L_MOSP)
save(Lambdas, file = sprintf("data/%s_all_Lambdas.rdata"),Name)


```

The next chunk is for the plots Tom made
```{r TomsPlots,}
AllD=merge(data,Lambdas)
AllD$AY=c(T,T,T,rep(F,nrow(AllD)-3))
AllD$Island=substr(AllD$Sites,1,3)
names(AllD)[which(names(AllD)=="AIC")]=c("g.AIC","s.AIC")
AllD$Sites=factor(AllD$Sites,levels=
  sort(unique(AllD$Sites))[c(1,9,16,2,3,14,15,10:13,4:8)])
AllD$Years=factor(AllD$Years,levels=
  sort(unique(AllD$Years)))
AllD$EndYear=as.numeric(substr(AllD$Years,4,5))
AllD$EndYear[AllD$Years=="All Years"]=20
AllD$StartYear=as.numeric(substr(AllD$Years,1,2))
AllD$StartYear[AllD$Years=="All Years"]=12


ggplot(AllD,aes(x=R.sqd,y=pR2,size=GModel.n,fill=log2(Lambdas)))+
  geom_point(aes(shape=AY),color="black",alpha=.65)+
  facet_grid(.~Genus_Code)+
  scale_fill_gradient2(midpoint = 0)+
  scale_shape_manual(values = c(22,21))+
  coord_equal()+
  theme_bw()

library(scales)
ggplot(AllD,aes(group=Genus_Code))+
  geom_hline(yintercept = c(14.75),size=3,color="gold")+
  geom_hline(yintercept = c(15.75),size=3,color="red")+
  geom_hline(yintercept = c(19.75),size=3,color="orange")+
  geom_linerange(aes(ymin=StartYear,ymax=EndYear,x=Sites,color=log2(Lambdas),size=log2(Lambdas)),
                 position=position_dodge(width=.5),alpha=1)+#,data=subset(AllD,Genus_Code=="POCS"))+
  geom_point(aes(shape=Genus_Code,y=StartYear,x=Sites),fill="black",size=2,position=position_dodge(width=.5),color="black",alpha=1)+#,data=subset(AllD,Genus_Code=="POCS"))+
  geom_point(aes(shape=Genus_Code,y=EndYear,x=Sites,size=log2(Lambdas),fill=log2(Lambdas)),position=position_dodge(width=.5),color="black",alpha=1)+
  geom_vline(xintercept = c(1.5,2.5,3.5,5.5,7.5,11.5))+
  scale_fill_distiller(type = "div",name="Lambda",palette = "Spectral",direction = 1,limits = c(-1,1))+
  #scale_fill_gradient2(name="Lambda",mid = "yellow",high="blue",low="red")+
  scale_size_area(name="Lambda")+
  scale_color_distiller(type = "div",name="Lambda",palette = "Spectral",direction = 1,limits = c(-1,1))+
  #scale_color_gradient2(name="Lambda",mid = "yellow",high="blue",low="red")+
  scale_shape_manual(name="Genus",values = c(22,21,23))+
#  scale_size_area(limits=log2(c(.5,2)),breaks=log2(seq(.5,2,length.out = 5)),labels=seq(.5,2,length.out = 5),oob=squish)+
  coord_equal()+
  coord_flip()+
  theme_bw()+
  theme(axis.text.x = element_text(angle=90,size = 10,hjust = 0),panel.background=element_rect(fill = "white"),panel.grid = element_blank())

ggplot(AllD,aes(group=Genus_Code))+
  geom_hline(yintercept = c(14.75),size=3,color="gold")+
  geom_hline(yintercept = c(15.75),size=3,color="red")+
  geom_hline(yintercept = c(19.75),size=3,color="orange")+
  geom_linerange(aes(ymin=StartYear,ymax=EndYear,x=Sites,color=log2(Lambdas),size=log2(Lambdas)),
                 position=position_dodge(width=.5),alpha=1)+#,data=subset(AllD,Genus_Code=="POCS"))+
  geom_point(aes(shape=Genus_Code,y=StartYear,x=Sites),fill="black",size=2,position=position_dodge(width=.5),color="black",alpha=1)+#,data=subset(AllD,Genus_Code=="POCS"))+
  geom_point(aes(shape=Genus_Code,y=EndYear,x=Sites,size=log2(Lambdas),fill=log2(Lambdas)),position=position_dodge(width=.5),color="black",alpha=1)+
  geom_vline(xintercept = c(1.5,2.5,3.5,5.5,7.5,11.5))+
  scale_fill_distiller(type = "div",name="Lambda",palette = "Spectral",direction = 1,limits = c(-1,1))+
  #scale_fill_gradient2(name="Lambda",mid = "yellow",high="blue",low="red")+
  scale_size_area(name="Lambda")+
  scale_color_distiller(type = "div",name="Lambda",palette = "Spectral",direction = 1,limits = c(-1,1))+
  #scale_color_gradient2(name="Lambda",mid = "yellow",high="blue",low="red")+
  scale_shape_manual(name="Genus",values = c(22,21,23))+
#  scale_size_area(limits=log2(c(.5,2)),breaks=log2(seq(.5,2,length.out = 5)),labels=seq(.5,2,length.out = 5),oob=squish)+
  coord_equal()+
  coord_flip()+
  theme_bw()+
  theme(axis.text.x = element_text(angle=90,size = 10,hjust = 0),panel.background=element_rect(fill = "white"),panel.grid = element_blank())



ggplot(subset(AllD,Sites=="MAI_SIO_K02"),aes(x=log2(Lambdas)))+
  geom_histogram(aes(fill=R.sqd,color=pR2))+
  geom_vline(aes(xintercept = log2(Lambdas)),color="red",data=subset(AllD,Sites=="All Sites"))+
  facet_grid(.~Genus_Code)+
  theme_bw()



```
Ignore the stuff below!!


```{r LoadData_Subsetting,}
# Loading in the data from analysis.Rmd
load("data/Growth_intmod_params.rdata")
load("data/Survival_intmod_params.rdata")
# load("data/Recruitment_sizeIndependent.rdata")
# load("data/Recruitment_sizeDependent.rdata")
load("data/SiteInterval_Gmodfits.rdata")
load("data/SiteInterval_Smodfits.rdata")

# Separating the growth data frame by genera #
POCS_G_1 <- dt[dt$Genus_Code == "POCS",][1,]
POCS_G_1 <- cbind(POCS_G_1, data.frame(g.var=0.230512176))
a        <- GrowthDataFrame[GrowthDataFrame$Genus_Code == "POCS",]
POCS_G_2 <- a[which(a$g.int >0),1:6]
POCS_G   <- rbind(POCS_G_1, POCS_G_2) 

POSP_G_1   <- dt[dt$Genus_Code == "POSP",][1,]
POSP_G_1 <- cbind(POSP_G_1, data.frame(g.var=0.372585621))
b        <- GrowthDataFrame[GrowthDataFrame$Genus_Code == "POSP",]
POSP_G_2 <- b[which(b$g.int >0),1:6]
POSP_G   <- rbind(POSP_G_1, POSP_G_2) 

MOSP_G_1   <- dt[dt$Genus_Code == "MOSP",][1,]
MOSP_G_1 <- cbind(MOSP_G_1, data.frame(g.var=1.102913776))
c        <- GrowthDataFrame[GrowthDataFrame$Genus_Code == "MOSP",] 
MOSP_G_2 <- c[which(c$g.int >0),1:6]
MOSP_G   <- rbind(MOSP_G_1, MOSP_G_2)

##############
#SURVIVAL
# subsetting the survival data frame by genera 
POCS_S_1 <- dS[dS$Genus_Code == "POCS",][1,]
a        <- SurvivalDataFrame[SurvivalDataFrame$Genus_Code == "POCS",]
POCS_S_2 <- a[which(a$s.int >0),1:5]
POCS_S   <- rbind(POCS_S_1,POCS_S_2)

POSP_S_1 <- dS[dS$Genus_Code == "POSP",][1,]
b        <- SurvivalDataFrame[SurvivalDataFrame$Genus_Code == "POSP",]
POSP_S_2 <- b[which(b$s.int >0),1:5]
POSP_S   <- rbind(POSP_S_1,POSP_S_2)

MOSP_S_1 <- dS[dS$Genus_Code == "MOSP",][1,]
c        <- SurvivalDataFrame[SurvivalDataFrame$Genus_Code == "MOSP",] 
MOSP_S_2 <- c[which(c$s.int >0),1:5]
MOSP_S   <- rbind(MOSP_S_1,MOSP_S_2)


# ##############
# #RECRUITMENT
# POCS_R <- subset(dr, Genus_Code == "POCS")
# POSP_R <- subset(dr, Genus_Code == "POSP")
# MOSP_R <- subset(dr, Genus_Code == "MOSP")
# 
# POCS_Rdep <- subset(dr_size, Genus_Code == "POCS")
# POSP_Rdep <- subset(dr_size, Genus_Code == "POSP")
# MOSP_Rdep <- subset(dr_size, Genus_Code == "MOSP")
# 
# POCS_R <- subset(POCS_R,Years == "All_Years" )
# totrecruits_POCS <- sum(POCS_R$Tots_recs_peryear, na.rm = T)
# mean(POCS_R$Tots_recs_peryear, na.rm = T)
# 
# POSP_R <- subset(POSP_R,Years == "All_Years" )
# totrecruits_POSP <- sum(POSP_R$Tots_recs_peryear, na.rm = T)
# mean(POSP_R$Tots_recs_peryear, na.rm = T)
# 
# MOSP_R <- subset(MOSP_R,Years == "All_Years" )
# totrecruits_MOSP <- sum(MOSP_R$Tots_recs_peryear, na.rm = T)
# mean(MOSP_R$Tots_recs_peryear, na.rm = T)


```


#Log likelihood Function
Measure of how well a particular model fits the data
Explains how well a parameter explains the observed data
Hope it will give range of recruitment values that give us a lambda of 1
The value of the parameter (recruitment #) that maximizes the probability of observing data (lambda)
*Will do this later

#Full IPM w/ recruitment model 1 (constant recruitment for all)
```{r}

GrowthModel   <- load("data/Growth_intmod_params.rdata")
SurvivalModel <- load("data/Survival_intmod_params.rdata")

# Separating the growth data frame by genera #
POCS_G <- subset(dt, Genus_Code == "POCS") 
POSP_G <- subset(dt, Genus_Code == "POSP")
MOSP_G <- subset(dt, Genus_Code == "MOSP")

##############
#SURVIVAL
# subsetting the survival data frame by genera 
POCS_S <- subset(dS, Genus_Code == "POCS")
POSP_S <- subset(dS, Genus_Code == "POSP")
MOSP_S <- subset(dS, Genus_Code == "MOSP")
```


#Plot IPM results
```{r}
#plot growth kernel
image(y,y,t(Growth_kernel), main='growth kernel')
abline(0,1,lwd=3)	# plot 1:1, which represents stasis

#plot survival kernel
plot(y,Survival_kernel,type = 'l', main = 'Survival' )
#this looks kinda weird...shouldn't it be more logistic reg shaped?

#Plot full kernel
y_a <- 2*(sqrt(10^y/pi))

#POCS
png(filename = "figs/no_2015_POCS_fullK.png")
image(y_a, y_a, t(pocs$K)^.1,)
title(GeneraNames[1], line=-1)
abline(0, 1, lty=2)
legend("bottomright", bty = "n", lty = c(0,0,2), col = 1,
       legend= c(sprintf("recruitment value = %.2f", recvalpc), sprintf("lambda = %.2f",  
                         round(pocs$lam,2)), "1:1 line"))
dev.off()

#POSP
png(filename = "figs/no2015_POSP_fullK.png")
image(y, y, t(posp$K)^.1,)
title(GeneraNames[2], line=-1)
abline(0, 1, lty=2)
legend("bottomright", bty = "n", lty = c(0,0,2), col = 1,
       legend= c(sprintf("recruitment value = %.2f", recvalpp), sprintf("lambda = %.2f",  
                         round(posp$lam,2)), "1:1 line"))
dev.off()

#MOSP
png(filename = "figs/no2015_MOSP_fullK.png")
image(y, y, t(mosp$K)^.1,)
title(GeneraNames[3], line=-1)
abline(0, 1, lty=2)
legend("bottomright", bty = "n", lty = c(0,0,2), col = 1,
       legend= c(sprintf("recruitment value = %.2f", recvalmp), sprintf("lambda = %.2f",  
                         round(mosp$lam,2)), "1:1 line"))
dev.off()


#Another way to plot full kernel
png(filename = "figs/no2015_MOSP_alternatefullK.png")
image(y, y, t(mosp$K)^.1, xlab="Size (t)",ylab="Size (t+1)",col=topo.colors(100), main="MOSP Kernel")
contour(y,y,t(mosp$K)^.1, add = TRUE, drawlabels = TRUE )
legend("bottomright", bty = "n", lty = c(0,0,2), col = 1,
       legend= c(sprintf("recruitment value = %.2f", recvalmp), sprintf("lambda = %.2f",  
                         round(mosp$lam,2)), "1:1 line"))
dev.off()

#Plot stable size distribution
png(filename = "figs/no2015_POCS_stablesizedist.png")
plot(y, pocs$w,xlab="Size",type="l",main="POCS Stable size distribution")
dev.off()

#Plot left eigenvector (reproductive value)
plot(y,reprodvalue,xlab="Size",type="l",main="Reproductive values")

#Plot Elasticity
png(filename = "figs/no2015_POCS_elasticity.png")
image(y,y[I],t(pocs$elas[I,])^0.2, xlab="Size (t)",ylab="Size (t+1)",main="POCS Elasticity") #[I] cuts out recruitment
abline(0,1,lwd=3)	# plot 1:1
dev.off()

#Plot Sensitivity
png(filename = "figs/no2015_POCS_sensitivity.png")
image(y,y,t(pocs$sens)^0.2, xlab="Size (t)",ylab="Size (t+1)", main="POCS Sensitivity")
abline(0,1,lwd=3)	# plot 1:1
dev.off()

```








